{% extends 'base.html' %}

{% block content %}

<div class="sidenav">
    <h3>Lesson {{ lesson_number }}</h3>
    <p>{{ lesson.title }}</p>
    {% for slide in slides %}
        {% if slide == current_slide %}
            <strong><a href="#">{{ slide.position }}. {{ slide.title }}</a></strong>
        {% else %}
            {% if active_lesson == lesson_number %}
                {% if active_slide < slide.position %}
                    <a href="#" style="color:rgb(167, 167, 167)">{{ slide.position }}. {{ slide.title }}</a>
                {% else %}
                    <a href="/lessons/{{ lesson_number }}/slide/{{ slide.position }}" style="color:bisque;">{{ slide.position }}. {{ slide.title }}</a>
                {% endif %}
            {% else %}
                <a href="/lessons/{{ lesson_number }}/slide/{{ slide.position }}" style="color:bisque;">{{ slide.position }}. {{ slide.title }}</a>
            {% endif %}
        {% endif %}
    {% endfor %}
    <a class="btn btn-secondary mt-4" href="/lessons/" style="width: 80%; margin: auto; text-align: left;" role="button">Back to index</a>
</div>

<div class="main" id="mainContent">

    <iframe class="my-3" width="800" height="600" src="{{ url }}" frameborder="0"></iframe>

    <p>{{ current_slide.bodyText }}</p>

    {% if role == 'student' %}
        {% if can_unlock_next_slide %}    
            <button type="button" class="btn btn-success" id="progressbutton">I'm ready</button>
        {% endif %}
        <hr>

        {% if current_slide_number > 1 %}
            <a class="btn btn-primary mb-4" href="/lessons/{{ lesson_number }}/slide/{{ previous_slide_number }}" role="button">Previous slide</a>
        {% else %}
            <button type="button" class="btn btn-primary mb-4" disabled>Previous slide</button>
        {% endif %}

        {% if is_final_slide %}
            {% if next_slide_is_available == False %}
                <button type="button" class="btn btn-primary float-right mb-4" onclick="startNextLesson()" id="continuebutton" disabled>
                    Next lesson
                </button>
            {% else %}
                <button type="button" class="btn btn-primary float-right mb-4" onclick="startNextLesson()" id="continuebutton">
                    Next lesson
                </button>
            {% endif %}
        {% else %}
            {% if next_slide_is_available == False %}
                <button type="button" class="btn btn-primary float-right mb-4" onclick="goToNextSlide()" id="continuebutton" disabled>
                    Next slide
                </button>
            {% else %}
                <button type="button" class="btn btn-primary float-right mb-4" onclick="goToNextSlide()" id="continuebutton">
                    Next slide
                </button>
            {% endif %}
        {% endif %}
    {% else %}
        {% if current_slide_number > 1 %}
            <a class="btn btn-primary mb-4" href="/lessons/{{ lesson_number }}/slide/{{ previous_slide_number }}" role="button">Previous slide</a>
        {% else %}
            <button type="button" class="btn btn-primary mb-4" disabled>Previous slide</button>
        {% endif %}

        {% if is_final_slide %}
            <button type="button" class="btn btn-primary float-right mb-4" onclick="startNextLesson()" id="continuebutton">
                Next lesson
            </button>
        {% else %}
            <button type="button" class="btn btn-primary float-right mb-4" onclick="goToNextSlide()" id="continuebutton">
                Next slide
            </button>
        {% endif %}
    {% endif %}


    <form action="">
        {% csrf_token %}
    </form>
    
</div>


{% endblock %}

{% block javascript %}
<script>
    function goToNextSlide() {
        window.location.href='/lessons/{{ lesson_number }}/slide/{{ next_slide_number }}';
    }

    function startNextLesson() {
        window.location.href='/lessons/{{ next_lesson_number }}/slide/1';
    }

    function enableNextSlide() {
        if(document.getElementById("continuebutton").disabled) {
            document.getElementById("continuebutton").disabled = false;
        
            var CSRFtoken = $('input[name=csrfmiddlewaretoken]').val();
     
            $.post('../../ajax/updateprogress/', {
                csrfmiddlewaretoken: CSRFtoken
            });
        }
    }

    document.getElementById("progressbutton").addEventListener("click", function() {
        enableNextSlide();
    })

    window.addEventListener('keydown', function(e) {
        if (e.keyCode == 32 && e.target == document.body) {
            e.preventDefault();
        }
    });
</script>
{% endblock %}
